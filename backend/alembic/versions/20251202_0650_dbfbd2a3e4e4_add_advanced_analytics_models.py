"""add_advanced_analytics_models

Revision ID: dbfbd2a3e4e4
Revises: 013
Create Date: 2025-12-02 06:50:06.324393

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 'dbfbd2a3e4e4'
down_revision = '013'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('kb_categories',
    sa.Column('name', sa.String(length=100), nullable=False, comment='Category name'),
    sa.Column('slug', sa.String(length=100), nullable=False, comment='URL-friendly slug'),
    sa.Column('description', sa.Text(), nullable=True, comment='Category description'),
    sa.Column('parent_id', sa.Integer(), nullable=True, comment='Parent category ID for hierarchy'),
    sa.Column('icon', sa.String(length=50), nullable=True, comment='Icon name/class for display'),
    sa.Column('order', sa.Integer(), nullable=False, comment='Display order within parent'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='Whether category is active'),
    sa.Column('is_public', sa.Boolean(), nullable=False, comment='Whether category is publicly visible'),
    sa.Column('article_count', sa.Integer(), nullable=False, comment='Number of articles in this category'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['parent_id'], ['kb_categories.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_kb_categories_id'), 'kb_categories', ['id'], unique=False)
    op.create_index(op.f('ix_kb_categories_is_active'), 'kb_categories', ['is_active'], unique=False)
    op.create_index(op.f('ix_kb_categories_name'), 'kb_categories', ['name'], unique=False)
    op.create_index(op.f('ix_kb_categories_parent_id'), 'kb_categories', ['parent_id'], unique=False)
    op.create_index(op.f('ix_kb_categories_slug'), 'kb_categories', ['slug'], unique=True)
    op.create_table('kpis',
    sa.Column('name', sa.String(length=255), nullable=False, comment='KPI name'),
    sa.Column('code', sa.String(length=100), nullable=False, comment='Unique KPI code'),
    sa.Column('description', sa.Text(), nullable=True, comment='KPI description'),
    sa.Column('category', sa.String(length=100), nullable=False, comment="KPI category (e.g., 'operations', 'hr', 'finance')"),
    sa.Column('current_value', sa.Numeric(precision=20, scale=4), nullable=True, comment='Current KPI value'),
    sa.Column('previous_value', sa.Numeric(precision=20, scale=4), nullable=True, comment='Previous period value'),
    sa.Column('target_value', sa.Numeric(precision=20, scale=4), nullable=True, comment='Target value to achieve'),
    sa.Column('warning_threshold', sa.Numeric(precision=20, scale=4), nullable=True, comment='Warning threshold'),
    sa.Column('critical_threshold', sa.Numeric(precision=20, scale=4), nullable=True, comment='Critical threshold'),
    sa.Column('trend', sa.Enum('UP', 'DOWN', 'STABLE', name='kpitrend'), nullable=True, comment='Trend direction'),
    sa.Column('trend_percentage', sa.Numeric(precision=10, scale=2), nullable=True, comment='Trend percentage change'),
    sa.Column('period', sa.Enum('DAILY', 'WEEKLY', 'MONTHLY', 'QUARTERLY', 'YEARLY', name='kpiperiod'), nullable=False),
    sa.Column('period_start', sa.DateTime(timezone=True), nullable=True, comment='Period start date'),
    sa.Column('period_end', sa.DateTime(timezone=True), nullable=True, comment='Period end date'),
    sa.Column('calculation_formula', sa.Text(), nullable=True, comment='Formula or query for calculating KPI'),
    sa.Column('unit', sa.String(length=50), nullable=True, comment='Unit of measurement (%, SAR, count, etc.)'),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('historical_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Historical values [{date, value}]'),
    sa.Column('last_calculated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_kpi_category_active', 'kpis', ['category', 'is_active'], unique=False)
    op.create_index('idx_kpi_period_dates', 'kpis', ['period', 'period_start', 'period_end'], unique=False)
    op.create_index(op.f('ix_kpis_category'), 'kpis', ['category'], unique=False)
    op.create_index(op.f('ix_kpis_code'), 'kpis', ['code'], unique=True)
    op.create_index(op.f('ix_kpis_id'), 'kpis', ['id'], unique=False)
    op.create_index(op.f('ix_kpis_is_active'), 'kpis', ['is_active'], unique=False)
    op.create_index(op.f('ix_kpis_name'), 'kpis', ['name'], unique=False)
    op.create_table('metric_snapshots',
    sa.Column('metric_name', sa.String(length=100), nullable=False, comment="Name of the metric (e.g., 'active_couriers', 'deliveries_completed')"),
    sa.Column('metric_type', sa.String(length=50), nullable=False, comment='Type: counter, gauge, histogram'),
    sa.Column('value', sa.Numeric(precision=20, scale=4), nullable=False, comment='Metric value'),
    sa.Column('dimensions', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment="Flexible dimensions (e.g., {'city': 'Riyadh', 'zone': 'North'})"),
    sa.Column('timestamp', sa.DateTime(timezone=True), nullable=False, comment='When the metric was recorded'),
    sa.Column('tags', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Additional tags for categorization'),
    sa.Column('source', sa.String(length=100), nullable=True, comment='Source system or service'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_dimensions_gin', 'metric_snapshots', ['dimensions'], unique=False, postgresql_using='gin')
    op.create_index('idx_metric_name_timestamp', 'metric_snapshots', ['metric_name', 'timestamp'], unique=False)
    op.create_index('idx_metric_type_timestamp', 'metric_snapshots', ['metric_type', 'timestamp'], unique=False)
    op.create_index('idx_tags_gin', 'metric_snapshots', ['tags'], unique=False, postgresql_using='gin')
    op.create_index(op.f('ix_metric_snapshots_id'), 'metric_snapshots', ['id'], unique=False)
    op.create_index(op.f('ix_metric_snapshots_metric_name'), 'metric_snapshots', ['metric_name'], unique=False)
    op.create_index(op.f('ix_metric_snapshots_metric_type'), 'metric_snapshots', ['metric_type'], unique=False)
    op.create_index(op.f('ix_metric_snapshots_timestamp'), 'metric_snapshots', ['timestamp'], unique=False)
    op.create_table('canned_responses',
    sa.Column('title', sa.String(length=100), nullable=False, comment='Response title/name'),
    sa.Column('shortcut', sa.String(length=50), nullable=True, comment='Keyboard shortcut (e.g., /greeting)'),
    sa.Column('content', sa.Text(), nullable=False, comment='Response content (can include variables like {customer_name})'),
    sa.Column('category', sa.String(length=100), nullable=False, comment='Response category (e.g., greeting, closing, technical)'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='Whether response is active'),
    sa.Column('is_public', sa.Boolean(), nullable=False, comment='Whether response is available to all agents'),
    sa.Column('usage_count', sa.Integer(), nullable=False, comment='Number of times this response was used'),
    sa.Column('created_by', sa.Integer(), nullable=True, comment='User who created the response'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_canned_responses_category'), 'canned_responses', ['category'], unique=False)
    op.create_index(op.f('ix_canned_responses_id'), 'canned_responses', ['id'], unique=False)
    op.create_index(op.f('ix_canned_responses_is_active'), 'canned_responses', ['is_active'], unique=False)
    op.create_index(op.f('ix_canned_responses_shortcut'), 'canned_responses', ['shortcut'], unique=True)
    op.create_index(op.f('ix_canned_responses_title'), 'canned_responses', ['title'], unique=False)
    op.create_table('dashboards',
    sa.Column('name', sa.String(length=255), nullable=False, comment='Dashboard name'),
    sa.Column('description', sa.Text(), nullable=True, comment='Dashboard description'),
    sa.Column('widgets', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='Array of widget configurations'),
    sa.Column('layout', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Dashboard layout configuration (grid positions, etc.)'),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('is_default', sa.Boolean(), nullable=False, comment="Is this the user's default dashboard?"),
    sa.Column('is_shared', sa.Boolean(), nullable=False, comment='Is dashboard shared with team?'),
    sa.Column('refresh_interval_seconds', sa.Integer(), nullable=False, comment='Auto-refresh interval'),
    sa.Column('filters', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Global dashboard filters'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_dashboard_shared', 'dashboards', ['is_shared', 'created_at'], unique=False)
    op.create_index('idx_dashboard_user_default', 'dashboards', ['user_id', 'is_default'], unique=False)
    op.create_index(op.f('ix_dashboards_id'), 'dashboards', ['id'], unique=False)
    op.create_index(op.f('ix_dashboards_user_id'), 'dashboards', ['user_id'], unique=False)
    op.create_table('reports',
    sa.Column('name', sa.String(length=255), nullable=False, comment='Report name'),
    sa.Column('description', sa.Text(), nullable=True, comment='Report description'),
    sa.Column('report_type', sa.Enum('COURIER_PERFORMANCE', 'FLEET_UTILIZATION', 'DELIVERY_ANALYTICS', 'FINANCIAL_SUMMARY', 'HR_ATTENDANCE', 'MAINTENANCE_REPORT', 'COD_RECONCILIATION', 'CUSTOM', name='reporttype'), nullable=False, comment='Type of report'),
    sa.Column('status', sa.Enum('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', 'SCHEDULED', name='reportstatus'), nullable=False),
    sa.Column('format', sa.Enum('PDF', 'EXCEL', 'CSV', 'JSON', name='reportformat'), nullable=False),
    sa.Column('parameters', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Report parameters (date range, filters, etc.)'),
    sa.Column('generated_at', sa.DateTime(timezone=True), nullable=True, comment='When report was generated'),
    sa.Column('scheduled_at', sa.DateTime(timezone=True), nullable=True, comment='For scheduled reports'),
    sa.Column('file_path', sa.String(length=500), nullable=True, comment='Path to generated report file'),
    sa.Column('file_size_bytes', sa.Integer(), nullable=True, comment='File size in bytes'),
    sa.Column('generated_by_user_id', sa.Integer(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True, comment='Error message if generation failed'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['generated_by_user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_report_generated_at', 'reports', ['generated_at'], unique=False)
    op.create_index('idx_report_type_status', 'reports', ['report_type', 'status'], unique=False)
    op.create_index('idx_report_user', 'reports', ['generated_by_user_id', 'generated_at'], unique=False)
    op.create_index(op.f('ix_reports_id'), 'reports', ['id'], unique=False)
    op.create_index(op.f('ix_reports_name'), 'reports', ['name'], unique=False)
    op.create_index(op.f('ix_reports_report_type'), 'reports', ['report_type'], unique=False)
    op.create_index(op.f('ix_reports_status'), 'reports', ['status'], unique=False)
    op.create_table('ticket_templates',
    sa.Column('name', sa.String(length=100), nullable=False, comment='Template name'),
    sa.Column('description', sa.String(length=500), nullable=True, comment='Template description'),
    sa.Column('default_subject', sa.String(length=255), nullable=True, comment='Default subject for tickets'),
    sa.Column('default_description', sa.Text(), nullable=True, comment='Default description template (can include placeholders)'),
    sa.Column('default_category', sa.Enum('TECHNICAL', 'BILLING', 'DELIVERY', 'COMPLAINT', 'FEATURE_REQUEST', 'HR', 'VEHICLE', 'ACCOMMODATION', 'FINANCE', 'OPERATIONS', 'IT', 'OTHER', name='ticketcategory'), nullable=True, comment='Default ticket category'),
    sa.Column('default_priority', sa.Enum('LOW', 'MEDIUM', 'HIGH', 'URGENT', name='ticketpriority'), nullable=True, comment='Default ticket priority'),
    sa.Column('default_department', sa.String(length=100), nullable=True, comment='Default department for routing'),
    sa.Column('default_tags', sa.Text(), nullable=True, comment='Default comma-separated tags'),
    sa.Column('default_custom_fields', sa.JSON(), nullable=True, comment='Default custom fields as JSON'),
    sa.Column('sla_hours', sa.Integer(), nullable=True, comment='SLA deadline in hours from creation'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='Whether template is active'),
    sa.Column('is_public', sa.Boolean(), nullable=False, comment='Whether template is available to all users'),
    sa.Column('created_by', sa.Integer(), nullable=True, comment='User who created the template'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ticket_templates_id'), 'ticket_templates', ['id'], unique=False)
    op.create_index(op.f('ix_ticket_templates_is_active'), 'ticket_templates', ['is_active'], unique=False)
    op.create_index(op.f('ix_ticket_templates_name'), 'ticket_templates', ['name'], unique=True)
    op.create_table('ticket_attachments',
    sa.Column('ticket_id', sa.Integer(), nullable=False, comment='Parent ticket ID'),
    sa.Column('reply_id', sa.Integer(), nullable=True, comment='Reply ID if attachment is on a reply'),
    sa.Column('uploaded_by', sa.Integer(), nullable=False, comment='User who uploaded the file'),
    sa.Column('filename', sa.String(length=255), nullable=False, comment='Original filename'),
    sa.Column('file_path', sa.String(length=500), nullable=False, comment='Storage path for the file'),
    sa.Column('file_type', sa.String(length=100), nullable=False, comment='MIME type of the file'),
    sa.Column('file_size', sa.BigInteger(), nullable=False, comment='File size in bytes'),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['reply_id'], ['ticket_replies.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['uploaded_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ticket_attachments_id'), 'ticket_attachments', ['id'], unique=False)
    op.create_index(op.f('ix_ticket_attachments_reply_id'), 'ticket_attachments', ['reply_id'], unique=False)
    op.create_index(op.f('ix_ticket_attachments_ticket_id'), 'ticket_attachments', ['ticket_id'], unique=False)
    op.drop_index(op.f('idx_vehicle_data_courier'), table_name='vehicle_data')
    op.drop_index(op.f('idx_vehicle_data_device'), table_name='vehicle_data')
    op.drop_index(op.f('idx_vehicle_data_organization'), table_name='vehicle_data')
    op.drop_index(op.f('idx_vehicle_data_timestamp'), table_name='vehicle_data')
    op.drop_index(op.f('idx_vehicle_data_type'), table_name='vehicle_data')
    op.drop_index(op.f('idx_vehicle_data_vehicle'), table_name='vehicle_data')
    op.drop_table('vehicle_data')
    op.drop_index(op.f('idx_orders_courier'), table_name='orders')
    op.drop_index(op.f('idx_orders_created'), table_name='orders')
    op.drop_index(op.f('idx_orders_date'), table_name='orders')
    op.drop_index(op.f('idx_orders_number'), table_name='orders')
    op.drop_index(op.f('idx_orders_organization'), table_name='orders')
    op.drop_index(op.f('idx_orders_status'), table_name='orders')
    op.drop_table('orders')
    op.drop_index(op.f('idx_task_assigned'), table_name='tasks')
    op.drop_index(op.f('idx_task_courier'), table_name='tasks')
    op.drop_index(op.f('idx_task_created'), table_name='tasks')
    op.drop_index(op.f('idx_task_due_date'), table_name='tasks')
    op.drop_index(op.f('idx_task_number'), table_name='tasks')
    op.drop_index(op.f('idx_task_organization'), table_name='tasks')
    op.drop_index(op.f('idx_task_status'), table_name='tasks')
    op.drop_table('tasks')
    op.drop_index(op.f('idx_sub_projects_code'), table_name='sub_projects')
    op.drop_index(op.f('idx_sub_projects_created'), table_name='sub_projects')
    op.drop_index(op.f('idx_sub_projects_manager'), table_name='sub_projects')
    op.drop_index(op.f('idx_sub_projects_organization'), table_name='sub_projects')
    op.drop_index(op.f('idx_sub_projects_status'), table_name='sub_projects')
    op.drop_table('sub_projects')
    op.drop_index(op.f('idx_assignments_courier'), table_name='assignments')
    op.drop_index(op.f('idx_assignments_number'), table_name='assignments')
    op.drop_index(op.f('idx_assignments_organization'), table_name='assignments')
    op.drop_index(op.f('idx_assignments_start_date'), table_name='assignments')
    op.drop_index(op.f('idx_assignments_status'), table_name='assignments')
    op.drop_index(op.f('idx_assignments_type'), table_name='assignments')
    op.drop_index(op.f('idx_assignments_vehicle'), table_name='assignments')
    op.drop_table('assignments')
    op.drop_index(op.f('idx_driver_orders_courier'), table_name='driver_orders')
    op.drop_index(op.f('idx_driver_orders_date'), table_name='driver_orders')
    op.drop_index(op.f('idx_driver_orders_organization'), table_name='driver_orders')
    op.drop_index(op.f('idx_driver_orders_platform'), table_name='driver_orders')
    op.drop_index(op.f('idx_driver_orders_status'), table_name='driver_orders')
    op.drop_table('driver_orders')
    op.alter_column('accident_logs', 'accident_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('COLLISION', 'SINGLE_VEHICLE', 'PEDESTRIAN', 'PROPERTY_DAMAGE', 'ROLLOVER', 'OTHER', name='accidenttype'),
               existing_nullable=False)
    op.alter_column('accident_logs', 'severity',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('MINOR', 'MODERATE', 'MAJOR', 'TOTAL_LOSS', name='accidentseverity'),
               existing_nullable=False)
    op.alter_column('accident_logs', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('REPORTED', 'UNDER_INVESTIGATION', 'INSURANCE_CLAIM_FILED', 'IN_REPAIR', 'RESOLVED', 'CLOSED', name='accidentstatus'),
               existing_nullable=False)
    op.alter_column('accident_logs', 'fault_status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('OUR_FAULT', 'OTHER_PARTY', 'SHARED', 'NO_FAULT', 'PENDING', name='faultstatus'),
               existing_nullable=True)
    op.drop_index(op.f('ix_accidents_city'), table_name='accident_logs')
    op.drop_index(op.f('ix_accidents_courier_id'), table_name='accident_logs')
    op.drop_index(op.f('ix_accidents_date'), table_name='accident_logs')
    op.drop_index(op.f('ix_accidents_id'), table_name='accident_logs')
    op.drop_index(op.f('ix_accidents_severity'), table_name='accident_logs')
    op.drop_index(op.f('ix_accidents_status'), table_name='accident_logs')
    op.drop_index(op.f('ix_accidents_vehicle_id'), table_name='accident_logs')
    op.create_index(op.f('ix_accident_logs_accident_date'), 'accident_logs', ['accident_date'], unique=False)
    op.create_index(op.f('ix_accident_logs_city'), 'accident_logs', ['city'], unique=False)
    op.create_index(op.f('ix_accident_logs_courier_id'), 'accident_logs', ['courier_id'], unique=False)
    op.create_index(op.f('ix_accident_logs_fault_status'), 'accident_logs', ['fault_status'], unique=False)
    op.create_index(op.f('ix_accident_logs_id'), 'accident_logs', ['id'], unique=False)
    op.create_index(op.f('ix_accident_logs_severity'), 'accident_logs', ['severity'], unique=False)
    op.create_index(op.f('ix_accident_logs_status'), 'accident_logs', ['status'], unique=False)
    op.create_index(op.f('ix_accident_logs_vehicle_id'), 'accident_logs', ['vehicle_id'], unique=False)
    op.create_unique_constraint(None, 'accident_logs', ['insurance_claim_number'])
    op.alter_column('allocations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('allocations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_allocations_active'), table_name='allocations')
    op.drop_index(op.f('ix_allocations_allocation_date'), table_name='allocations')
    op.drop_index(op.f('ix_allocations_bed_id'), table_name='allocations')
    op.drop_index(op.f('ix_allocations_courier_id'), table_name='allocations')
    op.create_index(op.f('ix_allocations_id'), 'allocations', ['id'], unique=False)
    op.drop_constraint(op.f('allocations_bed_id_fkey'), 'allocations', type_='foreignkey')
    op.drop_constraint(op.f('allocations_courier_id_fkey'), 'allocations', type_='foreignkey')
    op.create_foreign_key(None, 'allocations', 'beds', ['bed_id'], ['id'])
    op.create_foreign_key(None, 'allocations', 'couriers', ['courier_id'], ['id'])
    op.alter_column('assets', 'condition',
               existing_type=sa.VARCHAR(),
               nullable=True,
               existing_server_default=sa.text("'good'::character varying"))
    op.alter_column('assets', 'status',
               existing_type=postgresql.ENUM('assigned', 'returned', 'damaged', 'lost', name='assetstatus'),
               nullable=True,
               existing_server_default=sa.text("'assigned'::assetstatus"))
    op.alter_column('assets', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('assets', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_assets_asset_type'), table_name='assets')
    op.drop_index(op.f('ix_assets_courier_id'), table_name='assets')
    op.drop_index(op.f('ix_assets_status'), table_name='assets')
    op.create_index(op.f('ix_assets_id'), 'assets', ['id'], unique=False)
    op.drop_constraint(op.f('assets_courier_id_fkey'), 'assets', type_='foreignkey')
    op.create_foreign_key(None, 'assets', 'couriers', ['courier_id'], ['id'])
    op.alter_column('attendance', 'hours_worked',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('attendance', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('attendance', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_attendance_courier_id'), table_name='attendance')
    op.drop_index(op.f('ix_attendance_date'), table_name='attendance')
    op.drop_index(op.f('ix_attendance_status'), table_name='attendance')
    op.drop_constraint(op.f('uq_attendance_courier_date'), 'attendance', type_='unique')
    op.create_index(op.f('ix_attendance_id'), 'attendance', ['id'], unique=False)
    op.drop_constraint(op.f('attendance_courier_id_fkey'), 'attendance', type_='foreignkey')
    op.create_foreign_key(None, 'attendance', 'couriers', ['courier_id'], ['id'])
    op.alter_column('beds', 'status',
               existing_type=postgresql.ENUM('available', 'occupied', 'reserved', name='bedstatus'),
               nullable=True,
               existing_server_default=sa.text("'available'::bedstatus"))
    op.alter_column('beds', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('beds', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_beds_room_id'), table_name='beds')
    op.drop_index(op.f('ix_beds_status'), table_name='beds')
    op.drop_constraint(op.f('uq_bed_room_number'), 'beds', type_='unique')
    op.create_index(op.f('ix_beds_id'), 'beds', ['id'], unique=False)
    op.drop_constraint(op.f('beds_room_id_fkey'), 'beds', type_='foreignkey')
    op.create_foreign_key(None, 'beds', 'rooms', ['room_id'], ['id'])
    op.alter_column('buildings', 'total_rooms',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('buildings', 'total_capacity',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('buildings', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('buildings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_buildings_name'), table_name='buildings')
    op.create_index(op.f('ix_buildings_id'), 'buildings', ['id'], unique=False)
    op.alter_column('chat_messages', 'sender_id',
               existing_type=sa.INTEGER(),
               comment='User who sent the message',
               existing_comment='Message sender user ID',
               existing_nullable=False)
    op.alter_column('chat_messages', 'is_agent',
               existing_type=sa.BOOLEAN(),
               comment='Whether message is from agent (True) or customer (False)',
               existing_comment='Is from agent',
               existing_nullable=False)
    op.alter_column('chat_messages', 'is_system',
               existing_type=sa.BOOLEAN(),
               comment='Whether message is a system message',
               existing_comment='Is system message',
               existing_nullable=False)
    op.create_index(op.f('ix_chat_messages_id'), 'chat_messages', ['id'], unique=False)
    op.drop_table_comment(
        'chat_messages',
        existing_comment='Chat messages',
        schema=None
    )
    op.alter_column('chat_sessions', 'session_id',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique session identifier',
               existing_comment='Unique session ID',
               existing_nullable=False)
    op.alter_column('chat_sessions', 'status',
               existing_type=postgresql.ENUM('waiting', 'active', 'ended', 'transferred', name='chatstatus'),
               comment='Current session status',
               existing_comment='Session status',
               existing_nullable=False)
    op.alter_column('chat_sessions', 'started_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When agent joined the chat',
               existing_comment='When agent joined',
               existing_nullable=True)
    op.alter_column('chat_sessions', 'ended_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When chat session ended',
               existing_comment='When session ended',
               existing_nullable=True)
    op.alter_column('chat_sessions', 'initial_message',
               existing_type=sa.VARCHAR(length=500),
               comment="Customer's initial message",
               existing_comment='Initial customer message',
               existing_nullable=True)
    op.drop_constraint(op.f('chat_sessions_session_id_key'), 'chat_sessions', type_='unique')
    op.create_index(op.f('ix_chat_sessions_id'), 'chat_sessions', ['id'], unique=False)
    op.drop_table_comment(
        'chat_sessions',
        existing_comment='Live chat sessions',
        schema=None
    )
    op.alter_column('cod_transactions', 'status',
               existing_type=postgresql.ENUM('pending', 'collected', 'deposited', 'reconciled', name='codstatus'),
               nullable=True,
               existing_server_default=sa.text("'pending'::codstatus"))
    op.alter_column('cod_transactions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('cod_transactions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_cod_transactions_collection_date'), table_name='cod_transactions')
    op.drop_index(op.f('ix_cod_transactions_courier_id'), table_name='cod_transactions')
    op.drop_index(op.f('ix_cod_transactions_status'), table_name='cod_transactions')
    op.create_index(op.f('ix_cod_transactions_id'), 'cod_transactions', ['id'], unique=False)
    op.drop_constraint(op.f('cod_transactions_courier_id_fkey'), 'cod_transactions', type_='foreignkey')
    op.create_foreign_key(None, 'cod_transactions', 'couriers', ['courier_id'], ['id'])
    op.alter_column('courier_vehicle_assignments', 'assignment_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('PERMANENT', 'TEMPORARY', 'TRIAL', name='assignmenttype'),
               existing_nullable=False)
    op.alter_column('courier_vehicle_assignments', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('ACTIVE', 'COMPLETED', 'CANCELLED', name='assignmentstatus'),
               existing_nullable=False)
    op.drop_index(op.f('ix_assignments_courier_id'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_assignments_id'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_assignments_start_date'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_assignments_status'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_assignments_vehicle_id'), table_name='courier_vehicle_assignments')
    op.create_index(op.f('ix_courier_vehicle_assignments_courier_id'), 'courier_vehicle_assignments', ['courier_id'], unique=False)
    op.create_index(op.f('ix_courier_vehicle_assignments_id'), 'courier_vehicle_assignments', ['id'], unique=False)
    op.create_index(op.f('ix_courier_vehicle_assignments_start_date'), 'courier_vehicle_assignments', ['start_date'], unique=False)
    op.create_index(op.f('ix_courier_vehicle_assignments_status'), 'courier_vehicle_assignments', ['status'], unique=False)
    op.create_index(op.f('ix_courier_vehicle_assignments_vehicle_id'), 'courier_vehicle_assignments', ['vehicle_id'], unique=False)
    op.alter_column('couriers', 'barq_id',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique BARQ identifier',
               existing_nullable=False)
    op.alter_column('couriers', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('ACTIVE', 'INACTIVE', 'ON_LEAVE', 'TERMINATED', 'ONBOARDING', 'SUSPENDED', name='courierstatus'),
               existing_nullable=False)
    op.alter_column('couriers', 'sponsorship_status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('AJEER', 'INHOUSE', 'TRIAL', 'FREELANCER', name='sponsorshipstatus'),
               existing_nullable=True)
    op.alter_column('couriers', 'project_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('ECOMMERCE', 'FOOD', 'WAREHOUSE', 'BARQ', 'MIXED', name='projecttype'),
               existing_nullable=True)
    op.alter_column('couriers', 'accommodation_building_id',
               existing_type=sa.INTEGER(),
               comment='Will add FK to accommodation_buildings later',
               existing_nullable=True)
    op.alter_column('couriers', 'accommodation_room_id',
               existing_type=sa.INTEGER(),
               comment='Will add FK to accommodation_rooms later',
               existing_nullable=True)
    op.create_index(op.f('ix_couriers_employee_id'), 'couriers', ['employee_id'], unique=True)
    op.create_unique_constraint(None, 'couriers', ['passport_number'])
    op.create_unique_constraint(None, 'couriers', ['iqama_number'])
    op.create_unique_constraint(None, 'couriers', ['national_id'])
    op.alter_column('deliveries', 'status',
               existing_type=postgresql.ENUM('pending', 'in_transit', 'delivered', 'failed', 'returned', name='deliverystatus'),
               nullable=True,
               existing_server_default=sa.text("'pending'::deliverystatus"))
    op.alter_column('deliveries', 'cod_amount',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('deliveries', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('deliveries', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('idx_deliveries_courier'), table_name='deliveries')
    op.drop_index(op.f('ix_deliveries_courier_id'), table_name='deliveries')
    op.drop_index(op.f('ix_deliveries_created_at'), table_name='deliveries')
    op.drop_index(op.f('ix_deliveries_status'), table_name='deliveries')
    op.drop_index(op.f('ix_deliveries_tracking_number'), table_name='deliveries')
    op.create_index(op.f('ix_deliveries_id'), 'deliveries', ['id'], unique=False)
    op.drop_constraint(op.f('deliveries_courier_id_fkey'), 'deliveries', type_='foreignkey')
    op.create_foreign_key(None, 'deliveries', 'couriers', ['courier_id'], ['id'])
    op.drop_index(op.f('ix_documents_document_type'), table_name='documents')
    op.drop_index(op.f('ix_documents_entity_id'), table_name='documents')
    op.drop_index(op.f('ix_documents_entity_type'), table_name='documents')
    op.drop_index(op.f('ix_documents_entity_type_entity_id'), table_name='documents')
    op.alter_column('faqs', 'answer',
               existing_type=sa.TEXT(),
               comment='FAQ answer (Markdown supported)',
               existing_comment='FAQ answer (Markdown)',
               existing_nullable=False)
    op.alter_column('faqs', 'order',
               existing_type=sa.INTEGER(),
               comment='Display order within category',
               existing_comment='Display order',
               existing_nullable=False)
    op.alter_column('faqs', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Whether FAQ is active/visible',
               existing_comment='Active status',
               existing_nullable=False)
    op.alter_column('faqs', 'view_count',
               existing_type=sa.INTEGER(),
               comment='Number of times FAQ was viewed',
               existing_comment='View count',
               existing_nullable=False)
    op.create_index(op.f('ix_faqs_id'), 'faqs', ['id'], unique=False)
    op.drop_table_comment(
        'faqs',
        existing_comment='Frequently asked questions',
        schema=None
    )
    op.alter_column('feedbacks', 'user_id',
               existing_type=sa.INTEGER(),
               comment='User who submitted feedback (nullable for anonymous)',
               existing_comment='User who submitted feedback',
               existing_nullable=True)
    op.alter_column('feedbacks', 'rating',
               existing_type=sa.INTEGER(),
               comment='Rating (1-5 stars)',
               existing_comment='Rating 1-5 stars',
               existing_nullable=True)
    op.alter_column('feedbacks', 'status',
               existing_type=postgresql.ENUM('new', 'reviewed', 'in_progress', 'completed', 'dismissed', name='feedbackstatus'),
               comment='Feedback processing status',
               existing_comment='Processing status',
               existing_nullable=False)
    op.alter_column('feedbacks', 'response',
               existing_type=sa.TEXT(),
               comment='Response to the feedback',
               existing_comment='Response to feedback',
               existing_nullable=True)
    op.alter_column('feedbacks', 'responded_by',
               existing_type=sa.INTEGER(),
               comment='User who responded to feedback',
               existing_comment='User who responded',
               existing_nullable=True)
    op.create_index(op.f('ix_feedbacks_id'), 'feedbacks', ['id'], unique=False)
    op.drop_table_comment(
        'feedbacks',
        existing_comment='Customer feedback',
        schema=None
    )
    op.alter_column('incidents', 'status',
               existing_type=postgresql.ENUM('reported', 'investigating', 'resolved', 'closed', name='incidentstatus'),
               nullable=True,
               existing_server_default=sa.text("'reported'::incidentstatus"))
    op.alter_column('incidents', 'cost',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('incidents', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('incidents', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_incidents_courier_id'), table_name='incidents')
    op.drop_index(op.f('ix_incidents_incident_date'), table_name='incidents')
    op.drop_index(op.f('ix_incidents_incident_type'), table_name='incidents')
    op.drop_index(op.f('ix_incidents_status'), table_name='incidents')
    op.drop_index(op.f('ix_incidents_vehicle_id'), table_name='incidents')
    op.create_index(op.f('ix_incidents_id'), 'incidents', ['id'], unique=False)
    op.drop_constraint(op.f('incidents_vehicle_id_fkey'), 'incidents', type_='foreignkey')
    op.drop_constraint(op.f('incidents_courier_id_fkey'), 'incidents', type_='foreignkey')
    op.create_foreign_key(None, 'incidents', 'vehicles', ['vehicle_id'], ['id'])
    op.create_foreign_key(None, 'incidents', 'couriers', ['courier_id'], ['id'])
    op.alter_column('kb_articles', 'slug',
               existing_type=sa.VARCHAR(length=255),
               comment='URL-friendly slug for the article',
               existing_comment='URL-friendly slug',
               existing_nullable=False)
    op.alter_column('kb_articles', 'content',
               existing_type=sa.TEXT(),
               comment='Article content (Markdown supported)',
               existing_comment='Article content (Markdown)',
               existing_nullable=False)
    op.alter_column('kb_articles', 'summary',
               existing_type=sa.VARCHAR(length=500),
               comment='Short summary/excerpt',
               existing_comment='Short summary',
               existing_nullable=True)
    op.alter_column('kb_articles', 'tags',
               existing_type=sa.TEXT(),
               comment='Comma-separated tags for search',
               existing_comment='Comma-separated tags',
               existing_nullable=True)
    op.alter_column('kb_articles', 'status',
               existing_type=postgresql.ENUM('draft', 'published', 'archived', name='articlestatus'),
               comment='Article publication status',
               existing_comment='Publication status',
               existing_nullable=False)
    op.alter_column('kb_articles', 'version',
               existing_type=sa.INTEGER(),
               comment='Article version number',
               existing_comment='Article version',
               existing_nullable=False)
    op.alter_column('kb_articles', 'view_count',
               existing_type=sa.INTEGER(),
               comment='Number of times article was viewed',
               existing_comment='View count',
               existing_nullable=False)
    op.alter_column('kb_articles', 'helpful_count',
               existing_type=sa.INTEGER(),
               comment='Number of helpful votes',
               existing_comment='Helpful votes',
               existing_nullable=False)
    op.alter_column('kb_articles', 'not_helpful_count',
               existing_type=sa.INTEGER(),
               comment='Number of not helpful votes',
               existing_comment='Not helpful votes',
               existing_nullable=False)
    op.drop_constraint(op.f('kb_articles_slug_key'), 'kb_articles', type_='unique')
    op.create_index(op.f('ix_kb_articles_id'), 'kb_articles', ['id'], unique=False)
    op.drop_table_comment(
        'kb_articles',
        existing_comment='Knowledge base articles',
        schema=None
    )
    op.alter_column('leaves', 'status',
               existing_type=postgresql.ENUM('pending', 'approved', 'rejected', 'cancelled', name='leavestatus'),
               nullable=True,
               existing_server_default=sa.text("'pending'::leavestatus"))
    op.alter_column('leaves', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('leaves', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_leaves_courier_id'), table_name='leaves')
    op.drop_index(op.f('ix_leaves_start_date'), table_name='leaves')
    op.drop_index(op.f('ix_leaves_status'), table_name='leaves')
    op.create_index(op.f('ix_leaves_id'), 'leaves', ['id'], unique=False)
    op.drop_constraint(op.f('leaves_approved_by_fkey'), 'leaves', type_='foreignkey')
    op.drop_constraint(op.f('leaves_courier_id_fkey'), 'leaves', type_='foreignkey')
    op.create_foreign_key(None, 'leaves', 'users', ['approved_by'], ['id'])
    op.create_foreign_key(None, 'leaves', 'couriers', ['courier_id'], ['id'])
    op.alter_column('loans', 'status',
               existing_type=postgresql.ENUM('active', 'completed', 'cancelled', name='loanstatus'),
               nullable=True,
               existing_server_default=sa.text("'active'::loanstatus"))
    op.alter_column('loans', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('loans', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_loans_courier_id'), table_name='loans')
    op.drop_index(op.f('ix_loans_status'), table_name='loans')
    op.create_index(op.f('ix_loans_id'), 'loans', ['id'], unique=False)
    op.drop_constraint(op.f('loans_approved_by_fkey'), 'loans', type_='foreignkey')
    op.drop_constraint(op.f('loans_courier_id_fkey'), 'loans', type_='foreignkey')
    op.create_foreign_key(None, 'loans', 'users', ['approved_by'], ['id'])
    op.create_foreign_key(None, 'loans', 'couriers', ['courier_id'], ['id'])
    op.drop_index(op.f('ix_organization_users_is_active'), table_name='organization_users')
    op.drop_index(op.f('ix_organization_users_role'), table_name='organization_users')
    op.drop_index(op.f('ix_organizations_is_active'), table_name='organizations')
    op.drop_index(op.f('ix_organizations_subscription_plan'), table_name='organizations')
    op.drop_index(op.f('ix_organizations_subscription_status'), table_name='organizations')
    op.alter_column('performance_data', 'date',
               existing_type=sa.DATE(),
               comment='Performance date',
               existing_nullable=False)
    op.alter_column('performance_data', 'orders_completed',
               existing_type=sa.INTEGER(),
               comment='Total orders completed',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'orders_failed',
               existing_type=sa.INTEGER(),
               comment='Total orders failed/cancelled',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'on_time_deliveries',
               existing_type=sa.INTEGER(),
               comment='Deliveries on time',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'late_deliveries',
               existing_type=sa.INTEGER(),
               comment='Deliveries late',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'distance_covered_km',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               comment='Distance covered in KM',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'revenue_generated',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               comment='Revenue generated (SAR)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'cod_collected',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               comment='Cash on Delivery collected (SAR)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'average_rating',
               existing_type=sa.NUMERIC(precision=3, scale=2),
               comment='Average customer rating (0-5)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'working_hours',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               comment='Working hours',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'efficiency_score',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               comment='Efficiency score (0-100)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'notes',
               existing_type=sa.TEXT(),
               comment='Additional notes',
               existing_nullable=True)
    op.alter_column('performance_data', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('performance_data', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_performance_data_courier_date_range'), table_name='performance_data')
    op.drop_index(op.f('ix_performance_data_efficiency_score'), table_name='performance_data')
    op.drop_index(op.f('ix_performance_data_orders_completed'), table_name='performance_data')
    op.drop_index(op.f('ix_performance_data_revenue_generated'), table_name='performance_data')
    op.drop_constraint(op.f('uq_performance_courier_date'), 'performance_data', type_='unique')
    op.create_index(op.f('ix_performance_data_id'), 'performance_data', ['id'], unique=False)
    op.alter_column('rooms', 'occupied',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('rooms', 'status',
               existing_type=postgresql.ENUM('available', 'occupied', 'maintenance', name='roomstatus'),
               nullable=True,
               existing_server_default=sa.text("'available'::roomstatus"))
    op.alter_column('rooms', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('rooms', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_rooms_building_id'), table_name='rooms')
    op.drop_index(op.f('ix_rooms_status'), table_name='rooms')
    op.drop_constraint(op.f('uq_room_building_number'), 'rooms', type_='unique')
    op.create_index(op.f('ix_rooms_id'), 'rooms', ['id'], unique=False)
    op.drop_constraint(op.f('rooms_building_id_fkey'), 'rooms', type_='foreignkey')
    op.create_foreign_key(None, 'rooms', 'buildings', ['building_id'], ['id'])
    op.alter_column('routes', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('routes', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_routes_courier_date'), table_name='routes')
    op.drop_index(op.f('ix_routes_courier_id'), table_name='routes')
    op.drop_index(op.f('ix_routes_date'), table_name='routes')
    op.create_index(op.f('ix_routes_id'), 'routes', ['id'], unique=False)
    op.drop_constraint(op.f('routes_courier_id_fkey'), 'routes', type_='foreignkey')
    op.create_foreign_key(None, 'routes', 'couriers', ['courier_id'], ['id'])
    op.alter_column('salaries', 'allowances',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'deductions',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'loan_deduction',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'gosi_employee',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=True,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('salaries', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_salaries_courier_id'), table_name='salaries')
    op.drop_index(op.f('ix_salaries_month_year'), table_name='salaries')
    op.drop_constraint(op.f('uq_salary_courier_month_year'), 'salaries', type_='unique')
    op.create_index(op.f('ix_salaries_id'), 'salaries', ['id'], unique=False)
    op.drop_constraint(op.f('salaries_courier_id_fkey'), 'salaries', type_='foreignkey')
    op.create_foreign_key(None, 'salaries', 'couriers', ['courier_id'], ['id'])
    op.alter_column('ticket_replies', 'ticket_id',
               existing_type=sa.INTEGER(),
               comment='Parent ticket ID',
               existing_nullable=False)
    op.alter_column('ticket_replies', 'user_id',
               existing_type=sa.INTEGER(),
               comment='User who created this reply',
               existing_nullable=False)
    op.alter_column('ticket_replies', 'is_internal',
               existing_type=sa.INTEGER(),
               comment='Whether this is an internal note (1) or customer-facing (0)',
               existing_comment='Whether this is an internal note',
               existing_nullable=True)
    op.create_index(op.f('ix_ticket_replies_id'), 'ticket_replies', ['id'], unique=False)
    op.drop_table_comment(
        'ticket_replies',
        existing_comment='Ticket replies for threaded conversations',
        schema=None
    )
    op.add_column('tickets', sa.Column('sla_due_at', sa.DateTime(timezone=True), nullable=True, comment='SLA deadline for ticket resolution'))
    op.add_column('tickets', sa.Column('first_response_at', sa.DateTime(timezone=True), nullable=True, comment='When first response was made'))
    op.add_column('tickets', sa.Column('sla_breached', sa.Boolean(), nullable=False, comment='Whether SLA was breached'))
    op.add_column('tickets', sa.Column('escalation_level', sa.Enum('NONE', 'LEVEL_1', 'LEVEL_2', 'LEVEL_3', 'MANAGEMENT', name='escalationlevel'), nullable=False, comment='Current escalation level'))
    op.add_column('tickets', sa.Column('escalated_at', sa.DateTime(timezone=True), nullable=True, comment='When ticket was escalated'))
    op.add_column('tickets', sa.Column('escalated_by', sa.Integer(), nullable=True, comment='User who escalated the ticket'))
    op.add_column('tickets', sa.Column('escalation_reason', sa.Text(), nullable=True, comment='Reason for escalation'))
    op.add_column('tickets', sa.Column('merged_into_id', sa.Integer(), nullable=True, comment='ID of ticket this was merged into'))
    op.add_column('tickets', sa.Column('is_merged', sa.Boolean(), nullable=False, comment='Whether this ticket was merged into another'))
    op.add_column('tickets', sa.Column('template_id', sa.Integer(), nullable=True, comment='Template used to create this ticket'))
    op.add_column('tickets', sa.Column('tags', sa.Text(), nullable=True, comment='Comma-separated tags'))
    op.add_column('tickets', sa.Column('custom_fields', sa.JSON(), nullable=True, comment='Custom fields as JSON object'))
    op.add_column('tickets', sa.Column('contact_email', sa.String(length=255), nullable=True, comment='Contact email for notifications'))
    op.add_column('tickets', sa.Column('contact_phone', sa.String(length=50), nullable=True, comment='Contact phone number'))
    op.add_column('tickets', sa.Column('department', sa.String(length=100), nullable=True, comment='Department responsible for this ticket'))
    op.alter_column('tickets', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_tickets_category_status'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_created_at'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_status_priority'), table_name='tickets')
    op.drop_constraint(op.f('tickets_ticket_id_key'), 'tickets', type_='unique')
    op.create_index(op.f('ix_tickets_department'), 'tickets', ['department'], unique=False)
    op.create_index(op.f('ix_tickets_escalation_level'), 'tickets', ['escalation_level'], unique=False)
    op.create_index(op.f('ix_tickets_id'), 'tickets', ['id'], unique=False)
    op.create_index(op.f('ix_tickets_is_merged'), 'tickets', ['is_merged'], unique=False)
    op.create_index(op.f('ix_tickets_merged_into_id'), 'tickets', ['merged_into_id'], unique=False)
    op.create_index(op.f('ix_tickets_sla_breached'), 'tickets', ['sla_breached'], unique=False)
    op.create_index(op.f('ix_tickets_sla_due_at'), 'tickets', ['sla_due_at'], unique=False)
    op.create_foreign_key(None, 'tickets', 'ticket_templates', ['template_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(None, 'tickets', 'users', ['escalated_by'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(None, 'tickets', 'tickets', ['merged_into_id'], ['id'], ondelete='SET NULL')
    op.alter_column('vehicle_inspections', 'inspection_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('PRE_TRIP', 'POST_TRIP', 'PERIODIC', 'SAFETY', 'REGISTRATION', 'ACCIDENT', name='inspectiontype'),
               existing_nullable=False)
    op.alter_column('vehicle_inspections', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('PASSED', 'FAILED', 'CONDITIONAL', 'PENDING', name='inspectionstatus'),
               existing_nullable=False)
    op.alter_column('vehicle_inspections', 'overall_condition',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('EXCELLENT', 'GOOD', 'FAIR', 'POOR', name='vehiclecondition'),
               existing_nullable=True)
    op.drop_index(op.f('ix_inspections_date'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_inspections_id'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_inspections_status'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_inspections_type'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_inspections_vehicle_id'), table_name='vehicle_inspections')
    op.create_index(op.f('ix_vehicle_inspections_id'), 'vehicle_inspections', ['id'], unique=False)
    op.create_index(op.f('ix_vehicle_inspections_inspection_date'), 'vehicle_inspections', ['inspection_date'], unique=False)
    op.create_index(op.f('ix_vehicle_inspections_inspection_type'), 'vehicle_inspections', ['inspection_type'], unique=False)
    op.create_index(op.f('ix_vehicle_inspections_status'), 'vehicle_inspections', ['status'], unique=False)
    op.create_index(op.f('ix_vehicle_inspections_vehicle_id'), 'vehicle_inspections', ['vehicle_id'], unique=False)
    op.alter_column('vehicle_logs', 'log_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('DAILY_LOG', 'FUEL_REFILL', 'TRIP', 'DELIVERY', name='logtype'),
               existing_nullable=False)
    op.alter_column('vehicle_logs', 'fuel_provider',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('ARAMCO', 'ADNOC', 'PETROL', 'OTHER', name='fuelprovider'),
               existing_nullable=True)
    op.alter_column('vehicle_maintenance', 'maintenance_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('ROUTINE', 'PREVENTIVE', 'CORRECTIVE', 'BREAKDOWN', 'UPGRADE', name='maintenancetype'),
               existing_nullable=False)
    op.alter_column('vehicle_maintenance', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('SCHEDULED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED', name='maintenancestatus'),
               existing_nullable=False)
    op.alter_column('vehicle_maintenance', 'service_provider',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('IN_HOUSE', 'AUTHORIZED_DEALER', 'THIRD_PARTY', name='serviceprovider'),
               existing_nullable=True)
    op.drop_index(op.f('ix_maintenance_id'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_maintenance_scheduled_date'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_maintenance_status'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_maintenance_type'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_maintenance_vehicle_id'), table_name='vehicle_maintenance')
    op.create_index(op.f('ix_vehicle_maintenance_id'), 'vehicle_maintenance', ['id'], unique=False)
    op.create_index(op.f('ix_vehicle_maintenance_maintenance_type'), 'vehicle_maintenance', ['maintenance_type'], unique=False)
    op.create_index(op.f('ix_vehicle_maintenance_scheduled_date'), 'vehicle_maintenance', ['scheduled_date'], unique=False)
    op.create_index(op.f('ix_vehicle_maintenance_status'), 'vehicle_maintenance', ['status'], unique=False)
    op.create_index(op.f('ix_vehicle_maintenance_vehicle_id'), 'vehicle_maintenance', ['vehicle_id'], unique=False)
    op.create_unique_constraint(None, 'vehicle_maintenance', ['invoice_number'])
    op.alter_column('vehicles', 'plate_number',
               existing_type=sa.VARCHAR(length=20),
               comment='License plate number',
               existing_nullable=False)
    op.alter_column('vehicles', 'vehicle_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('MOTORCYCLE', 'CAR', 'VAN', 'TRUCK', 'BICYCLE', name='vehicletype'),
               existing_nullable=False)
    op.alter_column('vehicles', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('ACTIVE', 'MAINTENANCE', 'INACTIVE', 'RETIRED', 'REPAIR', name='vehiclestatus'),
               existing_nullable=False)
    op.alter_column('vehicles', 'ownership_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('OWNED', 'LEASED', 'RENTED', name='ownershiptype'),
               existing_nullable=True)
    op.alter_column('vehicles', 'vin_number',
               existing_type=sa.VARCHAR(length=50),
               comment='Vehicle Identification Number',
               existing_nullable=True)
    op.alter_column('vehicles', 'fuel_type',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('GASOLINE', 'DIESEL', 'ELECTRIC', 'HYBRID', name='fueltype'),
               existing_nullable=True)
    op.create_unique_constraint(None, 'vehicles', ['vin_number'])
    op.create_unique_constraint(None, 'vehicles', ['registration_number'])
    op.alter_column('workflow_instances', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'IN_PROGRESS', 'PENDING_APPROVAL', 'APPROVED', 'REJECTED', 'COMPLETED', 'CANCELLED', name='workflowstatus'),
               nullable=True,
               existing_server_default=sa.text("'DRAFT'::workflowstatus"))
    op.alter_column('workflow_instances', 'current_step',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('workflow_instances', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('workflow_instances', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_workflow_instances_created_at'), table_name='workflow_instances')
    op.drop_index(op.f('ix_workflow_instances_initiated_by'), table_name='workflow_instances')
    op.drop_index(op.f('ix_workflow_instances_status'), table_name='workflow_instances')
    op.drop_index(op.f('ix_workflow_instances_template_id'), table_name='workflow_instances')
    op.create_index(op.f('ix_workflow_instances_id'), 'workflow_instances', ['id'], unique=False)
    op.drop_constraint(op.f('workflow_instances_initiated_by_fkey'), 'workflow_instances', type_='foreignkey')
    op.drop_constraint(op.f('workflow_instances_template_id_fkey'), 'workflow_instances', type_='foreignkey')
    op.create_foreign_key(None, 'workflow_instances', 'users', ['initiated_by'], ['id'])
    op.create_foreign_key(None, 'workflow_instances', 'workflow_templates', ['template_id'], ['id'])
    op.alter_column('workflow_templates', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('true'))
    op.alter_column('workflow_templates', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('workflow_templates', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=True)
    op.drop_index(op.f('ix_workflow_templates_category'), table_name='workflow_templates')
    op.drop_index(op.f('ix_workflow_templates_is_active'), table_name='workflow_templates')
    op.drop_index(op.f('ix_workflow_templates_name'), table_name='workflow_templates')
    op.create_index(op.f('ix_workflow_templates_id'), 'workflow_templates', ['id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_workflow_templates_id'), table_name='workflow_templates')
    op.create_index(op.f('ix_workflow_templates_name'), 'workflow_templates', ['name'], unique=False)
    op.create_index(op.f('ix_workflow_templates_is_active'), 'workflow_templates', ['is_active'], unique=False)
    op.create_index(op.f('ix_workflow_templates_category'), 'workflow_templates', ['category'], unique=False)
    op.alter_column('workflow_templates', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('workflow_templates', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('workflow_templates', 'is_active',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('true'))
    op.drop_constraint(None, 'workflow_instances', type_='foreignkey')
    op.drop_constraint(None, 'workflow_instances', type_='foreignkey')
    op.create_foreign_key(op.f('workflow_instances_template_id_fkey'), 'workflow_instances', 'workflow_templates', ['template_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('workflow_instances_initiated_by_fkey'), 'workflow_instances', 'users', ['initiated_by'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_workflow_instances_id'), table_name='workflow_instances')
    op.create_index(op.f('ix_workflow_instances_template_id'), 'workflow_instances', ['template_id'], unique=False)
    op.create_index(op.f('ix_workflow_instances_status'), 'workflow_instances', ['status'], unique=False)
    op.create_index(op.f('ix_workflow_instances_initiated_by'), 'workflow_instances', ['initiated_by'], unique=False)
    op.create_index(op.f('ix_workflow_instances_created_at'), 'workflow_instances', ['created_at'], unique=False)
    op.alter_column('workflow_instances', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('workflow_instances', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('workflow_instances', 'current_step',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('workflow_instances', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'IN_PROGRESS', 'PENDING_APPROVAL', 'APPROVED', 'REJECTED', 'COMPLETED', 'CANCELLED', name='workflowstatus'),
               nullable=False,
               existing_server_default=sa.text("'DRAFT'::workflowstatus"))
    op.drop_constraint(None, 'vehicles', type_='unique')
    op.drop_constraint(None, 'vehicles', type_='unique')
    op.alter_column('vehicles', 'fuel_type',
               existing_type=sa.Enum('GASOLINE', 'DIESEL', 'ELECTRIC', 'HYBRID', name='fueltype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('vehicles', 'vin_number',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Vehicle Identification Number',
               existing_nullable=True)
    op.alter_column('vehicles', 'ownership_type',
               existing_type=sa.Enum('OWNED', 'LEASED', 'RENTED', name='ownershiptype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('vehicles', 'status',
               existing_type=sa.Enum('ACTIVE', 'MAINTENANCE', 'INACTIVE', 'RETIRED', 'REPAIR', name='vehiclestatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('vehicles', 'vehicle_type',
               existing_type=sa.Enum('MOTORCYCLE', 'CAR', 'VAN', 'TRUCK', 'BICYCLE', name='vehicletype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('vehicles', 'plate_number',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='License plate number',
               existing_nullable=False)
    op.drop_constraint(None, 'vehicle_maintenance', type_='unique')
    op.drop_index(op.f('ix_vehicle_maintenance_vehicle_id'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_vehicle_maintenance_status'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_vehicle_maintenance_scheduled_date'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_vehicle_maintenance_maintenance_type'), table_name='vehicle_maintenance')
    op.drop_index(op.f('ix_vehicle_maintenance_id'), table_name='vehicle_maintenance')
    op.create_index(op.f('ix_maintenance_vehicle_id'), 'vehicle_maintenance', ['vehicle_id'], unique=False)
    op.create_index(op.f('ix_maintenance_type'), 'vehicle_maintenance', ['maintenance_type'], unique=False)
    op.create_index(op.f('ix_maintenance_status'), 'vehicle_maintenance', ['status'], unique=False)
    op.create_index(op.f('ix_maintenance_scheduled_date'), 'vehicle_maintenance', ['scheduled_date'], unique=False)
    op.create_index(op.f('ix_maintenance_id'), 'vehicle_maintenance', ['id'], unique=False)
    op.alter_column('vehicle_maintenance', 'service_provider',
               existing_type=sa.Enum('IN_HOUSE', 'AUTHORIZED_DEALER', 'THIRD_PARTY', name='serviceprovider'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('vehicle_maintenance', 'status',
               existing_type=sa.Enum('SCHEDULED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED', name='maintenancestatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('vehicle_maintenance', 'maintenance_type',
               existing_type=sa.Enum('ROUTINE', 'PREVENTIVE', 'CORRECTIVE', 'BREAKDOWN', 'UPGRADE', name='maintenancetype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('vehicle_logs', 'fuel_provider',
               existing_type=sa.Enum('ARAMCO', 'ADNOC', 'PETROL', 'OTHER', name='fuelprovider'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('vehicle_logs', 'log_type',
               existing_type=sa.Enum('DAILY_LOG', 'FUEL_REFILL', 'TRIP', 'DELIVERY', name='logtype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.drop_index(op.f('ix_vehicle_inspections_vehicle_id'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_vehicle_inspections_status'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_vehicle_inspections_inspection_type'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_vehicle_inspections_inspection_date'), table_name='vehicle_inspections')
    op.drop_index(op.f('ix_vehicle_inspections_id'), table_name='vehicle_inspections')
    op.create_index(op.f('ix_inspections_vehicle_id'), 'vehicle_inspections', ['vehicle_id'], unique=False)
    op.create_index(op.f('ix_inspections_type'), 'vehicle_inspections', ['inspection_type'], unique=False)
    op.create_index(op.f('ix_inspections_status'), 'vehicle_inspections', ['status'], unique=False)
    op.create_index(op.f('ix_inspections_id'), 'vehicle_inspections', ['id'], unique=False)
    op.create_index(op.f('ix_inspections_date'), 'vehicle_inspections', ['inspection_date'], unique=False)
    op.alter_column('vehicle_inspections', 'overall_condition',
               existing_type=sa.Enum('EXCELLENT', 'GOOD', 'FAIR', 'POOR', name='vehiclecondition'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('vehicle_inspections', 'status',
               existing_type=sa.Enum('PASSED', 'FAILED', 'CONDITIONAL', 'PENDING', name='inspectionstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('vehicle_inspections', 'inspection_type',
               existing_type=sa.Enum('PRE_TRIP', 'POST_TRIP', 'PERIODIC', 'SAFETY', 'REGISTRATION', 'ACCIDENT', name='inspectiontype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.drop_constraint(None, 'tickets', type_='foreignkey')
    op.drop_constraint(None, 'tickets', type_='foreignkey')
    op.drop_constraint(None, 'tickets', type_='foreignkey')
    op.drop_index(op.f('ix_tickets_sla_due_at'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_sla_breached'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_merged_into_id'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_is_merged'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_id'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_escalation_level'), table_name='tickets')
    op.drop_index(op.f('ix_tickets_department'), table_name='tickets')
    op.create_unique_constraint(op.f('tickets_ticket_id_key'), 'tickets', ['ticket_id'])
    op.create_index(op.f('ix_tickets_status_priority'), 'tickets', ['status', 'priority'], unique=False)
    op.create_index(op.f('ix_tickets_created_at'), 'tickets', ['created_at'], unique=False)
    op.create_index(op.f('ix_tickets_category_status'), 'tickets', ['category', 'status'], unique=False)
    op.alter_column('tickets', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_column('tickets', 'department')
    op.drop_column('tickets', 'contact_phone')
    op.drop_column('tickets', 'contact_email')
    op.drop_column('tickets', 'custom_fields')
    op.drop_column('tickets', 'tags')
    op.drop_column('tickets', 'template_id')
    op.drop_column('tickets', 'is_merged')
    op.drop_column('tickets', 'merged_into_id')
    op.drop_column('tickets', 'escalation_reason')
    op.drop_column('tickets', 'escalated_by')
    op.drop_column('tickets', 'escalated_at')
    op.drop_column('tickets', 'escalation_level')
    op.drop_column('tickets', 'sla_breached')
    op.drop_column('tickets', 'first_response_at')
    op.drop_column('tickets', 'sla_due_at')
    op.create_table_comment(
        'ticket_replies',
        'Ticket replies for threaded conversations',
        existing_comment=None,
        schema=None
    )
    op.drop_index(op.f('ix_ticket_replies_id'), table_name='ticket_replies')
    op.alter_column('ticket_replies', 'is_internal',
               existing_type=sa.INTEGER(),
               comment='Whether this is an internal note',
               existing_comment='Whether this is an internal note (1) or customer-facing (0)',
               existing_nullable=True)
    op.alter_column('ticket_replies', 'user_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='User who created this reply',
               existing_nullable=False)
    op.alter_column('ticket_replies', 'ticket_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Parent ticket ID',
               existing_nullable=False)
    op.drop_constraint(None, 'salaries', type_='foreignkey')
    op.create_foreign_key(op.f('salaries_courier_id_fkey'), 'salaries', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_salaries_id'), table_name='salaries')
    op.create_unique_constraint(op.f('uq_salary_courier_month_year'), 'salaries', ['courier_id', 'month', 'year'])
    op.create_index(op.f('ix_salaries_month_year'), 'salaries', ['month', 'year'], unique=False)
    op.create_index(op.f('ix_salaries_courier_id'), 'salaries', ['courier_id'], unique=False)
    op.alter_column('salaries', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('salaries', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('salaries', 'gosi_employee',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'loan_deduction',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'deductions',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"))
    op.alter_column('salaries', 'allowances',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               nullable=False,
               existing_server_default=sa.text("'0'::numeric"))
    op.drop_constraint(None, 'routes', type_='foreignkey')
    op.create_foreign_key(op.f('routes_courier_id_fkey'), 'routes', 'couriers', ['courier_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_routes_id'), table_name='routes')
    op.create_index(op.f('ix_routes_date'), 'routes', ['date'], unique=False)
    op.create_index(op.f('ix_routes_courier_id'), 'routes', ['courier_id'], unique=False)
    op.create_index(op.f('ix_routes_courier_date'), 'routes', ['courier_id', 'date'], unique=False)
    op.alter_column('routes', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('routes', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'rooms', type_='foreignkey')
    op.create_foreign_key(op.f('rooms_building_id_fkey'), 'rooms', 'buildings', ['building_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_rooms_id'), table_name='rooms')
    op.create_unique_constraint(op.f('uq_room_building_number'), 'rooms', ['building_id', 'room_number'])
    op.create_index(op.f('ix_rooms_status'), 'rooms', ['status'], unique=False)
    op.create_index(op.f('ix_rooms_building_id'), 'rooms', ['building_id'], unique=False)
    op.alter_column('rooms', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('rooms', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('rooms', 'status',
               existing_type=postgresql.ENUM('available', 'occupied', 'maintenance', name='roomstatus'),
               nullable=False,
               existing_server_default=sa.text("'available'::roomstatus"))
    op.alter_column('rooms', 'occupied',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.drop_index(op.f('ix_performance_data_id'), table_name='performance_data')
    op.create_unique_constraint(op.f('uq_performance_courier_date'), 'performance_data', ['courier_id', 'date'])
    op.create_index(op.f('ix_performance_data_revenue_generated'), 'performance_data', ['revenue_generated'], unique=False)
    op.create_index(op.f('ix_performance_data_orders_completed'), 'performance_data', ['orders_completed'], unique=False)
    op.create_index(op.f('ix_performance_data_efficiency_score'), 'performance_data', ['efficiency_score'], unique=False)
    op.create_index(op.f('ix_performance_data_courier_date_range'), 'performance_data', ['courier_id', 'date'], unique=False)
    op.alter_column('performance_data', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('performance_data', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('performance_data', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Additional notes',
               existing_nullable=True)
    op.alter_column('performance_data', 'efficiency_score',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               comment=None,
               existing_comment='Efficiency score (0-100)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'working_hours',
               existing_type=sa.NUMERIC(precision=5, scale=2),
               comment=None,
               existing_comment='Working hours',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'average_rating',
               existing_type=sa.NUMERIC(precision=3, scale=2),
               comment=None,
               existing_comment='Average customer rating (0-5)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'cod_collected',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               comment=None,
               existing_comment='Cash on Delivery collected (SAR)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'revenue_generated',
               existing_type=sa.NUMERIC(precision=12, scale=2),
               comment=None,
               existing_comment='Revenue generated (SAR)',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'distance_covered_km',
               existing_type=sa.NUMERIC(precision=10, scale=2),
               comment=None,
               existing_comment='Distance covered in KM',
               existing_nullable=False,
               existing_server_default=sa.text('0.0'))
    op.alter_column('performance_data', 'late_deliveries',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Deliveries late',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'on_time_deliveries',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Deliveries on time',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'orders_failed',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Total orders failed/cancelled',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'orders_completed',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Total orders completed',
               existing_nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('performance_data', 'date',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='Performance date',
               existing_nullable=False)
    op.create_index(op.f('ix_organizations_subscription_status'), 'organizations', ['subscription_status'], unique=False)
    op.create_index(op.f('ix_organizations_subscription_plan'), 'organizations', ['subscription_plan'], unique=False)
    op.create_index(op.f('ix_organizations_is_active'), 'organizations', ['is_active'], unique=False)
    op.create_index(op.f('ix_organization_users_role'), 'organization_users', ['role'], unique=False)
    op.create_index(op.f('ix_organization_users_is_active'), 'organization_users', ['is_active'], unique=False)
    op.drop_constraint(None, 'loans', type_='foreignkey')
    op.drop_constraint(None, 'loans', type_='foreignkey')
    op.create_foreign_key(op.f('loans_courier_id_fkey'), 'loans', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('loans_approved_by_fkey'), 'loans', 'users', ['approved_by'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_loans_id'), table_name='loans')
    op.create_index(op.f('ix_loans_status'), 'loans', ['status'], unique=False)
    op.create_index(op.f('ix_loans_courier_id'), 'loans', ['courier_id'], unique=False)
    op.alter_column('loans', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('loans', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('loans', 'status',
               existing_type=postgresql.ENUM('active', 'completed', 'cancelled', name='loanstatus'),
               nullable=False,
               existing_server_default=sa.text("'active'::loanstatus"))
    op.drop_constraint(None, 'leaves', type_='foreignkey')
    op.drop_constraint(None, 'leaves', type_='foreignkey')
    op.create_foreign_key(op.f('leaves_courier_id_fkey'), 'leaves', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('leaves_approved_by_fkey'), 'leaves', 'users', ['approved_by'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_leaves_id'), table_name='leaves')
    op.create_index(op.f('ix_leaves_status'), 'leaves', ['status'], unique=False)
    op.create_index(op.f('ix_leaves_start_date'), 'leaves', ['start_date'], unique=False)
    op.create_index(op.f('ix_leaves_courier_id'), 'leaves', ['courier_id'], unique=False)
    op.alter_column('leaves', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('leaves', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('leaves', 'status',
               existing_type=postgresql.ENUM('pending', 'approved', 'rejected', 'cancelled', name='leavestatus'),
               nullable=False,
               existing_server_default=sa.text("'pending'::leavestatus"))
    op.create_table_comment(
        'kb_articles',
        'Knowledge base articles',
        existing_comment=None,
        schema=None
    )
    op.drop_index(op.f('ix_kb_articles_id'), table_name='kb_articles')
    op.create_unique_constraint(op.f('kb_articles_slug_key'), 'kb_articles', ['slug'])
    op.alter_column('kb_articles', 'not_helpful_count',
               existing_type=sa.INTEGER(),
               comment='Not helpful votes',
               existing_comment='Number of not helpful votes',
               existing_nullable=False)
    op.alter_column('kb_articles', 'helpful_count',
               existing_type=sa.INTEGER(),
               comment='Helpful votes',
               existing_comment='Number of helpful votes',
               existing_nullable=False)
    op.alter_column('kb_articles', 'view_count',
               existing_type=sa.INTEGER(),
               comment='View count',
               existing_comment='Number of times article was viewed',
               existing_nullable=False)
    op.alter_column('kb_articles', 'version',
               existing_type=sa.INTEGER(),
               comment='Article version',
               existing_comment='Article version number',
               existing_nullable=False)
    op.alter_column('kb_articles', 'status',
               existing_type=postgresql.ENUM('draft', 'published', 'archived', name='articlestatus'),
               comment='Publication status',
               existing_comment='Article publication status',
               existing_nullable=False)
    op.alter_column('kb_articles', 'tags',
               existing_type=sa.TEXT(),
               comment='Comma-separated tags',
               existing_comment='Comma-separated tags for search',
               existing_nullable=True)
    op.alter_column('kb_articles', 'summary',
               existing_type=sa.VARCHAR(length=500),
               comment='Short summary',
               existing_comment='Short summary/excerpt',
               existing_nullable=True)
    op.alter_column('kb_articles', 'content',
               existing_type=sa.TEXT(),
               comment='Article content (Markdown)',
               existing_comment='Article content (Markdown supported)',
               existing_nullable=False)
    op.alter_column('kb_articles', 'slug',
               existing_type=sa.VARCHAR(length=255),
               comment='URL-friendly slug',
               existing_comment='URL-friendly slug for the article',
               existing_nullable=False)
    op.drop_constraint(None, 'incidents', type_='foreignkey')
    op.drop_constraint(None, 'incidents', type_='foreignkey')
    op.create_foreign_key(op.f('incidents_courier_id_fkey'), 'incidents', 'couriers', ['courier_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('incidents_vehicle_id_fkey'), 'incidents', 'vehicles', ['vehicle_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_incidents_id'), table_name='incidents')
    op.create_index(op.f('ix_incidents_vehicle_id'), 'incidents', ['vehicle_id'], unique=False)
    op.create_index(op.f('ix_incidents_status'), 'incidents', ['status'], unique=False)
    op.create_index(op.f('ix_incidents_incident_type'), 'incidents', ['incident_type'], unique=False)
    op.create_index(op.f('ix_incidents_incident_date'), 'incidents', ['incident_date'], unique=False)
    op.create_index(op.f('ix_incidents_courier_id'), 'incidents', ['courier_id'], unique=False)
    op.alter_column('incidents', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('incidents', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('incidents', 'cost',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('incidents', 'status',
               existing_type=postgresql.ENUM('reported', 'investigating', 'resolved', 'closed', name='incidentstatus'),
               nullable=False,
               existing_server_default=sa.text("'reported'::incidentstatus"))
    op.create_table_comment(
        'feedbacks',
        'Customer feedback',
        existing_comment=None,
        schema=None
    )
    op.drop_index(op.f('ix_feedbacks_id'), table_name='feedbacks')
    op.alter_column('feedbacks', 'responded_by',
               existing_type=sa.INTEGER(),
               comment='User who responded',
               existing_comment='User who responded to feedback',
               existing_nullable=True)
    op.alter_column('feedbacks', 'response',
               existing_type=sa.TEXT(),
               comment='Response to feedback',
               existing_comment='Response to the feedback',
               existing_nullable=True)
    op.alter_column('feedbacks', 'status',
               existing_type=postgresql.ENUM('new', 'reviewed', 'in_progress', 'completed', 'dismissed', name='feedbackstatus'),
               comment='Processing status',
               existing_comment='Feedback processing status',
               existing_nullable=False)
    op.alter_column('feedbacks', 'rating',
               existing_type=sa.INTEGER(),
               comment='Rating 1-5 stars',
               existing_comment='Rating (1-5 stars)',
               existing_nullable=True)
    op.alter_column('feedbacks', 'user_id',
               existing_type=sa.INTEGER(),
               comment='User who submitted feedback',
               existing_comment='User who submitted feedback (nullable for anonymous)',
               existing_nullable=True)
    op.create_table_comment(
        'faqs',
        'Frequently asked questions',
        existing_comment=None,
        schema=None
    )
    op.drop_index(op.f('ix_faqs_id'), table_name='faqs')
    op.alter_column('faqs', 'view_count',
               existing_type=sa.INTEGER(),
               comment='View count',
               existing_comment='Number of times FAQ was viewed',
               existing_nullable=False)
    op.alter_column('faqs', 'is_active',
               existing_type=sa.BOOLEAN(),
               comment='Active status',
               existing_comment='Whether FAQ is active/visible',
               existing_nullable=False)
    op.alter_column('faqs', 'order',
               existing_type=sa.INTEGER(),
               comment='Display order',
               existing_comment='Display order within category',
               existing_nullable=False)
    op.alter_column('faqs', 'answer',
               existing_type=sa.TEXT(),
               comment='FAQ answer (Markdown)',
               existing_comment='FAQ answer (Markdown supported)',
               existing_nullable=False)
    op.create_index(op.f('ix_documents_entity_type_entity_id'), 'documents', ['entity_type', 'entity_id'], unique=False)
    op.create_index(op.f('ix_documents_entity_type'), 'documents', ['entity_type'], unique=False)
    op.create_index(op.f('ix_documents_entity_id'), 'documents', ['entity_id'], unique=False)
    op.create_index(op.f('ix_documents_document_type'), 'documents', ['document_type'], unique=False)
    op.drop_constraint(None, 'deliveries', type_='foreignkey')
    op.create_foreign_key(op.f('deliveries_courier_id_fkey'), 'deliveries', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_deliveries_id'), table_name='deliveries')
    op.create_index(op.f('ix_deliveries_tracking_number'), 'deliveries', ['tracking_number'], unique=False)
    op.create_index(op.f('ix_deliveries_status'), 'deliveries', ['status'], unique=False)
    op.create_index(op.f('ix_deliveries_created_at'), 'deliveries', ['created_at'], unique=False)
    op.create_index(op.f('ix_deliveries_courier_id'), 'deliveries', ['courier_id'], unique=False)
    op.create_index(op.f('idx_deliveries_courier'), 'deliveries', ['courier_id'], unique=False)
    op.alter_column('deliveries', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('deliveries', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('deliveries', 'cod_amount',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('deliveries', 'status',
               existing_type=postgresql.ENUM('pending', 'in_transit', 'delivered', 'failed', 'returned', name='deliverystatus'),
               nullable=False,
               existing_server_default=sa.text("'pending'::deliverystatus"))
    op.drop_constraint(None, 'couriers', type_='unique')
    op.drop_constraint(None, 'couriers', type_='unique')
    op.drop_constraint(None, 'couriers', type_='unique')
    op.drop_index(op.f('ix_couriers_employee_id'), table_name='couriers')
    op.alter_column('couriers', 'accommodation_room_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Will add FK to accommodation_rooms later',
               existing_nullable=True)
    op.alter_column('couriers', 'accommodation_building_id',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Will add FK to accommodation_buildings later',
               existing_nullable=True)
    op.alter_column('couriers', 'project_type',
               existing_type=sa.Enum('ECOMMERCE', 'FOOD', 'WAREHOUSE', 'BARQ', 'MIXED', name='projecttype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('couriers', 'sponsorship_status',
               existing_type=sa.Enum('AJEER', 'INHOUSE', 'TRIAL', 'FREELANCER', name='sponsorshipstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('couriers', 'status',
               existing_type=sa.Enum('ACTIVE', 'INACTIVE', 'ON_LEAVE', 'TERMINATED', 'ONBOARDING', 'SUSPENDED', name='courierstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('couriers', 'barq_id',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Unique BARQ identifier',
               existing_nullable=False)
    op.drop_index(op.f('ix_courier_vehicle_assignments_vehicle_id'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_courier_vehicle_assignments_status'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_courier_vehicle_assignments_start_date'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_courier_vehicle_assignments_id'), table_name='courier_vehicle_assignments')
    op.drop_index(op.f('ix_courier_vehicle_assignments_courier_id'), table_name='courier_vehicle_assignments')
    op.create_index(op.f('ix_assignments_vehicle_id'), 'courier_vehicle_assignments', ['vehicle_id'], unique=False)
    op.create_index(op.f('ix_assignments_status'), 'courier_vehicle_assignments', ['status'], unique=False)
    op.create_index(op.f('ix_assignments_start_date'), 'courier_vehicle_assignments', ['start_date'], unique=False)
    op.create_index(op.f('ix_assignments_id'), 'courier_vehicle_assignments', ['id'], unique=False)
    op.create_index(op.f('ix_assignments_courier_id'), 'courier_vehicle_assignments', ['courier_id'], unique=False)
    op.alter_column('courier_vehicle_assignments', 'status',
               existing_type=sa.Enum('ACTIVE', 'COMPLETED', 'CANCELLED', name='assignmentstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('courier_vehicle_assignments', 'assignment_type',
               existing_type=sa.Enum('PERMANENT', 'TEMPORARY', 'TRIAL', name='assignmenttype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.drop_constraint(None, 'cod_transactions', type_='foreignkey')
    op.create_foreign_key(op.f('cod_transactions_courier_id_fkey'), 'cod_transactions', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_cod_transactions_id'), table_name='cod_transactions')
    op.create_index(op.f('ix_cod_transactions_status'), 'cod_transactions', ['status'], unique=False)
    op.create_index(op.f('ix_cod_transactions_courier_id'), 'cod_transactions', ['courier_id'], unique=False)
    op.create_index(op.f('ix_cod_transactions_collection_date'), 'cod_transactions', ['collection_date'], unique=False)
    op.alter_column('cod_transactions', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('cod_transactions', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('cod_transactions', 'status',
               existing_type=postgresql.ENUM('pending', 'collected', 'deposited', 'reconciled', name='codstatus'),
               nullable=False,
               existing_server_default=sa.text("'pending'::codstatus"))
    op.create_table_comment(
        'chat_sessions',
        'Live chat sessions',
        existing_comment=None,
        schema=None
    )
    op.drop_index(op.f('ix_chat_sessions_id'), table_name='chat_sessions')
    op.create_unique_constraint(op.f('chat_sessions_session_id_key'), 'chat_sessions', ['session_id'])
    op.alter_column('chat_sessions', 'initial_message',
               existing_type=sa.VARCHAR(length=500),
               comment='Initial customer message',
               existing_comment="Customer's initial message",
               existing_nullable=True)
    op.alter_column('chat_sessions', 'ended_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When session ended',
               existing_comment='When chat session ended',
               existing_nullable=True)
    op.alter_column('chat_sessions', 'started_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When agent joined',
               existing_comment='When agent joined the chat',
               existing_nullable=True)
    op.alter_column('chat_sessions', 'status',
               existing_type=postgresql.ENUM('waiting', 'active', 'ended', 'transferred', name='chatstatus'),
               comment='Session status',
               existing_comment='Current session status',
               existing_nullable=False)
    op.alter_column('chat_sessions', 'session_id',
               existing_type=sa.VARCHAR(length=50),
               comment='Unique session ID',
               existing_comment='Unique session identifier',
               existing_nullable=False)
    op.create_table_comment(
        'chat_messages',
        'Chat messages',
        existing_comment=None,
        schema=None
    )
    op.drop_index(op.f('ix_chat_messages_id'), table_name='chat_messages')
    op.alter_column('chat_messages', 'is_system',
               existing_type=sa.BOOLEAN(),
               comment='Is system message',
               existing_comment='Whether message is a system message',
               existing_nullable=False)
    op.alter_column('chat_messages', 'is_agent',
               existing_type=sa.BOOLEAN(),
               comment='Is from agent',
               existing_comment='Whether message is from agent (True) or customer (False)',
               existing_nullable=False)
    op.alter_column('chat_messages', 'sender_id',
               existing_type=sa.INTEGER(),
               comment='Message sender user ID',
               existing_comment='User who sent the message',
               existing_nullable=False)
    op.drop_index(op.f('ix_buildings_id'), table_name='buildings')
    op.create_index(op.f('ix_buildings_name'), 'buildings', ['name'], unique=True)
    op.alter_column('buildings', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('buildings', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('buildings', 'total_capacity',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.alter_column('buildings', 'total_rooms',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.drop_constraint(None, 'beds', type_='foreignkey')
    op.create_foreign_key(op.f('beds_room_id_fkey'), 'beds', 'rooms', ['room_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_beds_id'), table_name='beds')
    op.create_unique_constraint(op.f('uq_bed_room_number'), 'beds', ['room_id', 'bed_number'])
    op.create_index(op.f('ix_beds_status'), 'beds', ['status'], unique=False)
    op.create_index(op.f('ix_beds_room_id'), 'beds', ['room_id'], unique=False)
    op.alter_column('beds', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('beds', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('beds', 'status',
               existing_type=postgresql.ENUM('available', 'occupied', 'reserved', name='bedstatus'),
               nullable=False,
               existing_server_default=sa.text("'available'::bedstatus"))
    op.drop_constraint(None, 'attendance', type_='foreignkey')
    op.create_foreign_key(op.f('attendance_courier_id_fkey'), 'attendance', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_attendance_id'), table_name='attendance')
    op.create_unique_constraint(op.f('uq_attendance_courier_date'), 'attendance', ['courier_id', 'date'])
    op.create_index(op.f('ix_attendance_status'), 'attendance', ['status'], unique=False)
    op.create_index(op.f('ix_attendance_date'), 'attendance', ['date'], unique=False)
    op.create_index(op.f('ix_attendance_courier_id'), 'attendance', ['courier_id'], unique=False)
    op.alter_column('attendance', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('attendance', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('attendance', 'hours_worked',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.drop_constraint(None, 'assets', type_='foreignkey')
    op.create_foreign_key(op.f('assets_courier_id_fkey'), 'assets', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_assets_id'), table_name='assets')
    op.create_index(op.f('ix_assets_status'), 'assets', ['status'], unique=False)
    op.create_index(op.f('ix_assets_courier_id'), 'assets', ['courier_id'], unique=False)
    op.create_index(op.f('ix_assets_asset_type'), 'assets', ['asset_type'], unique=False)
    op.alter_column('assets', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('assets', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('assets', 'status',
               existing_type=postgresql.ENUM('assigned', 'returned', 'damaged', 'lost', name='assetstatus'),
               nullable=False,
               existing_server_default=sa.text("'assigned'::assetstatus"))
    op.alter_column('assets', 'condition',
               existing_type=sa.VARCHAR(),
               nullable=False,
               existing_server_default=sa.text("'good'::character varying"))
    op.drop_constraint(None, 'allocations', type_='foreignkey')
    op.drop_constraint(None, 'allocations', type_='foreignkey')
    op.create_foreign_key(op.f('allocations_courier_id_fkey'), 'allocations', 'couriers', ['courier_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('allocations_bed_id_fkey'), 'allocations', 'beds', ['bed_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_allocations_id'), table_name='allocations')
    op.create_index(op.f('ix_allocations_courier_id'), 'allocations', ['courier_id'], unique=False)
    op.create_index(op.f('ix_allocations_bed_id'), 'allocations', ['bed_id'], unique=False)
    op.create_index(op.f('ix_allocations_allocation_date'), 'allocations', ['allocation_date'], unique=False)
    op.create_index(op.f('ix_allocations_active'), 'allocations', ['courier_id', 'release_date'], unique=False)
    op.alter_column('allocations', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=True)
    op.alter_column('allocations', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'accident_logs', type_='unique')
    op.drop_index(op.f('ix_accident_logs_vehicle_id'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_status'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_severity'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_id'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_fault_status'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_courier_id'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_city'), table_name='accident_logs')
    op.drop_index(op.f('ix_accident_logs_accident_date'), table_name='accident_logs')
    op.create_index(op.f('ix_accidents_vehicle_id'), 'accident_logs', ['vehicle_id'], unique=False)
    op.create_index(op.f('ix_accidents_status'), 'accident_logs', ['status'], unique=False)
    op.create_index(op.f('ix_accidents_severity'), 'accident_logs', ['severity'], unique=False)
    op.create_index(op.f('ix_accidents_id'), 'accident_logs', ['id'], unique=False)
    op.create_index(op.f('ix_accidents_date'), 'accident_logs', ['accident_date'], unique=False)
    op.create_index(op.f('ix_accidents_courier_id'), 'accident_logs', ['courier_id'], unique=False)
    op.create_index(op.f('ix_accidents_city'), 'accident_logs', ['city'], unique=False)
    op.alter_column('accident_logs', 'fault_status',
               existing_type=sa.Enum('OUR_FAULT', 'OTHER_PARTY', 'SHARED', 'NO_FAULT', 'PENDING', name='faultstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.alter_column('accident_logs', 'status',
               existing_type=sa.Enum('REPORTED', 'UNDER_INVESTIGATION', 'INSURANCE_CLAIM_FILED', 'IN_REPAIR', 'RESOLVED', 'CLOSED', name='accidentstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('accident_logs', 'severity',
               existing_type=sa.Enum('MINOR', 'MODERATE', 'MAJOR', 'TOTAL_LOSS', name='accidentseverity'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.alter_column('accident_logs', 'accident_type',
               existing_type=sa.Enum('COLLISION', 'SINGLE_VEHICLE', 'PEDESTRIAN', 'PROPERTY_DAMAGE', 'ROLLOVER', 'OTHER', name='accidenttype'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=False)
    op.create_table('driver_orders',
    sa.Column('id', sa.BIGINT(), autoincrement=True, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('courier_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('platform', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('platform_order_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('platform_driver_id', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('order_number', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('order_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=False),
    sa.Column('delivery_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), server_default=sa.text("'pending'::character varying"), autoincrement=False, nullable=False),
    sa.Column('order_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('pickup_address', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('delivery_address', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('customer_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('customer_phone', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('distance_km', sa.NUMERIC(precision=8, scale=2), autoincrement=False, nullable=True),
    sa.Column('delivery_time_minutes', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('delivery_fee', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('cod_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('incentive_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('total_earnings', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('rating', sa.NUMERIC(precision=3, scale=2), autoincrement=False, nullable=True),
    sa.Column('feedback', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('raw_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('sync_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['courier_id'], ['couriers.id'], name=op.f('fk_driver_orders_courier')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('fk_driver_orders_organization')),
    sa.PrimaryKeyConstraint('id', name=op.f('driver_orders_pkey')),
    sa.UniqueConstraint('platform', 'platform_order_id', 'organization_id', name=op.f('uq_driver_order_platform'))
    )
    op.create_index(op.f('idx_driver_orders_status'), 'driver_orders', ['status'], unique=False)
    op.create_index(op.f('idx_driver_orders_platform'), 'driver_orders', ['platform', 'platform_driver_id'], unique=False)
    op.create_index(op.f('idx_driver_orders_organization'), 'driver_orders', ['organization_id'], unique=False)
    op.create_index(op.f('idx_driver_orders_date'), 'driver_orders', ['order_date'], unique=False)
    op.create_index(op.f('idx_driver_orders_courier'), 'driver_orders', ['courier_id'], unique=False)
    op.create_table('assignments',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('assignment_number', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('assignment_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('courier_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('vehicle_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('asset_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('zone_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), server_default=sa.text("'active'::character varying"), autoincrement=False, nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=True),
    sa.Column('is_permanent', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('assigned_by', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('assigned_date', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('terminated_by', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('terminated_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('termination_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('location', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('shift_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('attachments_urls', postgresql.ARRAY(sa.TEXT()), autoincrement=False, nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['assigned_by'], ['users.id'], name=op.f('fk_assignments_assigned_by')),
    sa.ForeignKeyConstraint(['courier_id'], ['couriers.id'], name=op.f('fk_assignments_courier')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('fk_assignments_organization')),
    sa.ForeignKeyConstraint(['terminated_by'], ['users.id'], name=op.f('fk_assignments_terminated_by')),
    sa.ForeignKeyConstraint(['vehicle_id'], ['vehicles.id'], name=op.f('fk_assignments_vehicle')),
    sa.PrimaryKeyConstraint('id', name=op.f('assignments_pkey')),
    sa.UniqueConstraint('assignment_number', name=op.f('assignments_assignment_number_key'))
    )
    op.create_index(op.f('idx_assignments_vehicle'), 'assignments', ['vehicle_id'], unique=False)
    op.create_index(op.f('idx_assignments_type'), 'assignments', ['assignment_type'], unique=False)
    op.create_index(op.f('idx_assignments_status'), 'assignments', ['status'], unique=False)
    op.create_index(op.f('idx_assignments_start_date'), 'assignments', ['start_date'], unique=False)
    op.create_index(op.f('idx_assignments_organization'), 'assignments', ['organization_id'], unique=False)
    op.create_index(op.f('idx_assignments_number'), 'assignments', ['assignment_number'], unique=False)
    op.create_index(op.f('idx_assignments_courier'), 'assignments', ['courier_id'], unique=False)
    op.create_table('sub_projects',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('project_code', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('project_name', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('project_name_ar', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('project_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), server_default=sa.text("'active'::character varying"), autoincrement=False, nullable=False),
    sa.Column('start_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('end_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('budget', sa.NUMERIC(precision=12, scale=2), autoincrement=False, nullable=True),
    sa.Column('spent_amount', sa.NUMERIC(precision=12, scale=2), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('city', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('location', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('manager_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('client_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('client_contact', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('contract_url', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('total_couriers', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('total_vehicles', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.Column('performance_metrics', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('settings', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('tags', postgresql.ARRAY(sa.TEXT()), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], name=op.f('fk_sub_projects_created_by')),
    sa.ForeignKeyConstraint(['manager_id'], ['users.id'], name=op.f('fk_sub_projects_manager')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('fk_sub_projects_organization')),
    sa.PrimaryKeyConstraint('id', name=op.f('sub_projects_pkey')),
    sa.UniqueConstraint('project_code', name=op.f('sub_projects_project_code_key'))
    )
    op.create_index(op.f('idx_sub_projects_status'), 'sub_projects', ['status'], unique=False)
    op.create_index(op.f('idx_sub_projects_organization'), 'sub_projects', ['organization_id'], unique=False)
    op.create_index(op.f('idx_sub_projects_manager'), 'sub_projects', ['manager_id'], unique=False)
    op.create_index(op.f('idx_sub_projects_created'), 'sub_projects', ['created_at'], unique=False)
    op.create_index(op.f('idx_sub_projects_code'), 'sub_projects', ['project_code'], unique=False)
    op.create_table('tasks',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('task_number', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('task_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('priority', sa.VARCHAR(length=20), server_default=sa.text("'medium'::character varying"), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=50), server_default=sa.text("'pending'::character varying"), autoincrement=False, nullable=False),
    sa.Column('assigned_to', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('assigned_by', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('courier_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('vehicle_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('related_entity_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('related_entity_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('due_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('scheduled_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('started_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('completed_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('completion_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('location', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('latitude', sa.NUMERIC(precision=10, scale=8), autoincrement=False, nullable=True),
    sa.Column('longitude', sa.NUMERIC(precision=11, scale=8), autoincrement=False, nullable=True),
    sa.Column('estimated_duration', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('actual_duration', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('attachments_urls', postgresql.ARRAY(sa.TEXT()), autoincrement=False, nullable=True),
    sa.Column('tags', postgresql.ARRAY(sa.TEXT()), autoincrement=False, nullable=True),
    sa.Column('is_recurring', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('recurrence_pattern', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('parent_task_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['assigned_by'], ['users.id'], name=op.f('fk_tasks_assigned_by')),
    sa.ForeignKeyConstraint(['assigned_to'], ['users.id'], name=op.f('fk_tasks_assigned_to')),
    sa.ForeignKeyConstraint(['courier_id'], ['couriers.id'], name=op.f('fk_tasks_courier')),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], name=op.f('fk_tasks_created_by')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('fk_tasks_organization')),
    sa.ForeignKeyConstraint(['vehicle_id'], ['vehicles.id'], name=op.f('fk_tasks_vehicle')),
    sa.PrimaryKeyConstraint('id', name=op.f('tasks_pkey')),
    sa.UniqueConstraint('task_number', name=op.f('tasks_task_number_key'))
    )
    op.create_index(op.f('idx_task_status'), 'tasks', ['status'], unique=False)
    op.create_index(op.f('idx_task_organization'), 'tasks', ['organization_id'], unique=False)
    op.create_index(op.f('idx_task_number'), 'tasks', ['task_number'], unique=False)
    op.create_index(op.f('idx_task_due_date'), 'tasks', ['due_date'], unique=False)
    op.create_index(op.f('idx_task_created'), 'tasks', ['created_at'], unique=False)
    op.create_index(op.f('idx_task_courier'), 'tasks', ['courier_id'], unique=False)
    op.create_index(op.f('idx_task_assigned'), 'tasks', ['assigned_to'], unique=False)
    op.create_table('orders',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('order_number', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('courier_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('vehicle_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('customer_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('customer_phone', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('pickup_address', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('delivery_address', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('pickup_latitude', sa.NUMERIC(precision=10, scale=8), autoincrement=False, nullable=True),
    sa.Column('pickup_longitude', sa.NUMERIC(precision=11, scale=8), autoincrement=False, nullable=True),
    sa.Column('delivery_latitude', sa.NUMERIC(precision=10, scale=8), autoincrement=False, nullable=True),
    sa.Column('delivery_longitude', sa.NUMERIC(precision=11, scale=8), autoincrement=False, nullable=True),
    sa.Column('order_date', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('scheduled_date', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('pickup_time', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('delivery_time', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), server_default=sa.text("'pending'::character varying"), autoincrement=False, nullable=False),
    sa.Column('priority', sa.VARCHAR(length=20), server_default=sa.text("'normal'::character varying"), autoincrement=False, nullable=True),
    sa.Column('order_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('payment_method', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('cod_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('delivery_fee', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('total_amount', sa.NUMERIC(precision=10, scale=2), autoincrement=False, nullable=True),
    sa.Column('distance_km', sa.NUMERIC(precision=8, scale=2), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('special_instructions', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('proof_of_delivery_url', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('customer_signature_url', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('rating', sa.NUMERIC(precision=3, scale=2), autoincrement=False, nullable=True),
    sa.Column('customer_feedback', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_by', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('assigned_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('completed_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('cancelled_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.Column('cancellation_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['courier_id'], ['couriers.id'], name=op.f('fk_orders_courier')),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], name=op.f('fk_orders_user')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('fk_orders_organization')),
    sa.ForeignKeyConstraint(['vehicle_id'], ['vehicles.id'], name=op.f('fk_orders_vehicle')),
    sa.PrimaryKeyConstraint('id', name=op.f('orders_pkey')),
    sa.UniqueConstraint('order_number', name=op.f('orders_order_number_key'))
    )
    op.create_index(op.f('idx_orders_status'), 'orders', ['status'], unique=False)
    op.create_index(op.f('idx_orders_organization'), 'orders', ['organization_id'], unique=False)
    op.create_index(op.f('idx_orders_number'), 'orders', ['order_number'], unique=False)
    op.create_index(op.f('idx_orders_date'), 'orders', ['order_date'], unique=False)
    op.create_index(op.f('idx_orders_created'), 'orders', ['created_at'], unique=False)
    op.create_index(op.f('idx_orders_courier'), 'orders', ['courier_id'], unique=False)
    op.create_table('vehicle_data',
    sa.Column('id', sa.BIGINT(), autoincrement=True, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('vehicle_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('courier_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('data_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('timestamp', postgresql.TIMESTAMP(precision=6), autoincrement=False, nullable=False),
    sa.Column('latitude', sa.NUMERIC(precision=10, scale=8), autoincrement=False, nullable=True),
    sa.Column('longitude', sa.NUMERIC(precision=11, scale=8), autoincrement=False, nullable=True),
    sa.Column('speed', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=True),
    sa.Column('heading', sa.NUMERIC(precision=6, scale=2), autoincrement=False, nullable=True),
    sa.Column('altitude', sa.NUMERIC(precision=8, scale=2), autoincrement=False, nullable=True),
    sa.Column('odometer', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('fuel_level', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('engine_status', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('battery_voltage', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('coolant_temp', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=True),
    sa.Column('rpm', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('ignition_status', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('door_status', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('ac_status', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('harsh_acceleration', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('harsh_braking', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('harsh_cornering', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('over_speeding', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True),
    sa.Column('idle_time', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('driving_time', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('gps_signal_quality', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('gsm_signal_quality', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('event_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('event_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('raw_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('device_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('imei', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(precision=6), server_default=sa.text('CURRENT_TIMESTAMP'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['courier_id'], ['couriers.id'], name=op.f('fk_vehicle_data_courier')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('fk_vehicle_data_organization')),
    sa.ForeignKeyConstraint(['vehicle_id'], ['vehicles.id'], name=op.f('fk_vehicle_data_vehicle'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('vehicle_data_pkey'))
    )
    op.create_index(op.f('idx_vehicle_data_vehicle'), 'vehicle_data', ['vehicle_id'], unique=False)
    op.create_index(op.f('idx_vehicle_data_type'), 'vehicle_data', ['data_type'], unique=False)
    op.create_index(op.f('idx_vehicle_data_timestamp'), 'vehicle_data', ['timestamp'], unique=False)
    op.create_index(op.f('idx_vehicle_data_organization'), 'vehicle_data', ['organization_id'], unique=False)
    op.create_index(op.f('idx_vehicle_data_device'), 'vehicle_data', ['device_id'], unique=False)
    op.create_index(op.f('idx_vehicle_data_courier'), 'vehicle_data', ['courier_id'], unique=False)
    op.drop_index(op.f('ix_ticket_attachments_ticket_id'), table_name='ticket_attachments')
    op.drop_index(op.f('ix_ticket_attachments_reply_id'), table_name='ticket_attachments')
    op.drop_index(op.f('ix_ticket_attachments_id'), table_name='ticket_attachments')
    op.drop_table('ticket_attachments')
    op.drop_index(op.f('ix_ticket_templates_name'), table_name='ticket_templates')
    op.drop_index(op.f('ix_ticket_templates_is_active'), table_name='ticket_templates')
    op.drop_index(op.f('ix_ticket_templates_id'), table_name='ticket_templates')
    op.drop_table('ticket_templates')
    op.drop_index(op.f('ix_reports_status'), table_name='reports')
    op.drop_index(op.f('ix_reports_report_type'), table_name='reports')
    op.drop_index(op.f('ix_reports_name'), table_name='reports')
    op.drop_index(op.f('ix_reports_id'), table_name='reports')
    op.drop_index('idx_report_user', table_name='reports')
    op.drop_index('idx_report_type_status', table_name='reports')
    op.drop_index('idx_report_generated_at', table_name='reports')
    op.drop_table('reports')
    op.drop_index(op.f('ix_dashboards_user_id'), table_name='dashboards')
    op.drop_index(op.f('ix_dashboards_id'), table_name='dashboards')
    op.drop_index('idx_dashboard_user_default', table_name='dashboards')
    op.drop_index('idx_dashboard_shared', table_name='dashboards')
    op.drop_table('dashboards')
    op.drop_index(op.f('ix_canned_responses_title'), table_name='canned_responses')
    op.drop_index(op.f('ix_canned_responses_shortcut'), table_name='canned_responses')
    op.drop_index(op.f('ix_canned_responses_is_active'), table_name='canned_responses')
    op.drop_index(op.f('ix_canned_responses_id'), table_name='canned_responses')
    op.drop_index(op.f('ix_canned_responses_category'), table_name='canned_responses')
    op.drop_table('canned_responses')
    op.drop_index(op.f('ix_metric_snapshots_timestamp'), table_name='metric_snapshots')
    op.drop_index(op.f('ix_metric_snapshots_metric_type'), table_name='metric_snapshots')
    op.drop_index(op.f('ix_metric_snapshots_metric_name'), table_name='metric_snapshots')
    op.drop_index(op.f('ix_metric_snapshots_id'), table_name='metric_snapshots')
    op.drop_index('idx_tags_gin', table_name='metric_snapshots', postgresql_using='gin')
    op.drop_index('idx_metric_type_timestamp', table_name='metric_snapshots')
    op.drop_index('idx_metric_name_timestamp', table_name='metric_snapshots')
    op.drop_index('idx_dimensions_gin', table_name='metric_snapshots', postgresql_using='gin')
    op.drop_table('metric_snapshots')
    op.drop_index(op.f('ix_kpis_name'), table_name='kpis')
    op.drop_index(op.f('ix_kpis_is_active'), table_name='kpis')
    op.drop_index(op.f('ix_kpis_id'), table_name='kpis')
    op.drop_index(op.f('ix_kpis_code'), table_name='kpis')
    op.drop_index(op.f('ix_kpis_category'), table_name='kpis')
    op.drop_index('idx_kpi_period_dates', table_name='kpis')
    op.drop_index('idx_kpi_category_active', table_name='kpis')
    op.drop_table('kpis')
    op.drop_index(op.f('ix_kb_categories_slug'), table_name='kb_categories')
    op.drop_index(op.f('ix_kb_categories_parent_id'), table_name='kb_categories')
    op.drop_index(op.f('ix_kb_categories_name'), table_name='kb_categories')
    op.drop_index(op.f('ix_kb_categories_is_active'), table_name='kb_categories')
    op.drop_index(op.f('ix_kb_categories_id'), table_name='kb_categories')
    op.drop_table('kb_categories')
    # ### end Alembic commands ###
